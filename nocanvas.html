<!DOCTYPE html>
<html>
<head>
<title>Target Practice</title>
<meta charset="utf-8">
<link rel="stylesheet" type="text/css" href="css/style.css">

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script>

function bullet(x, y, offset)
{
  var bullet=document.createElement("div");
  bullet.className="bullet";
  bullet.style.left=x-offset.left-5+"px";
  bullet.style.top=y-offset.top-5+"px";
  bullet.dataset.left=x-offset.left-5;
  bullet.dataset.left="0";
  return bullet;
}


// has game started yet
var started = false;

// offset of game field
var offset;

var speed = 1;

var origin = {"x": 490, "y": 0};

var turret={};
turret.x=490;
turret.y=0;
turret.length=80;
turret.angle=90;

var shot={};

function calculate_shot()
{

  var angle = turret.angle / 180 * Math.PI;
  
  shot.x = turret.length*Math.cos(angle) + turret.x;
  shot.y = turret.length*Math.sin(angle) + turret.y;

}

$(document).ready(function(){

  $(document).keydown(function(e)
  {
  
    if(e.keyCode==37)
      turret.angle -= 5;
    if(e.keyCode==39)
      turret.angle += 5;
  
    if(turret.angle <= 20)
      turret.angle = 20;
    else if(turret.angle >= 160)
      turret.angle = 160;
  
    document.title=turret.angle;
  
    $("#turret").css("transform", "rotate(" + turret.angle + "deg)");
    
  });

  $("#game").click(function(e){
    //$(this).append(bullet(e.clientX, e.clientY, $(this).offset()));
    
    //alert($(".bullet").attr("data-x"));
    //$(".bullet").css("background","red");
    
    
    //$(".bullet").css("left","-=8");
    //$(".bullet").css("left",$(".bullet").attr("data-left"));
    
    //console.log($(".bullet").attr("data-left"));
    
    
    
    offset = $("#turret").offset();
    
    calculate_shot();
    
    $("<div>")
      .addClass("bullet")
      // -5 (half of bullet width) -20 (border of game field)
      //.css("left", e.clientX-offset.left-5-20+"px")
      //.css("top", e.clientY-offset.top-5-20+"px")
      .css("right", shot.x+"px")
      //.css("top", offset.top+"px")
      .css("bottom", shot.y+"px")
      .data("angle", turret.angle)
      .appendTo($(this));
    
    if(!started)
    {
      started=true;
      animate();
    }
    
  });
  
  
});
</script>


</head>

<body>


<div id="game">

<div id="turret"><div id="barrel"></div></div>

</div>

<script>
var request_frame = (function(callback)
{
  return window.requestAnimationFrame || window.webkitRequestAnimationFrame || window.mozRequestAnimationFrame || window.oRequestAnimationFrame || window.msRequestAnimationFrame || function(callback) {window.setTimeout(callback, 1000 / 60);};
})();

var i = 0;

function get_value(str, value)
{

}

function animate()
{


//alert(e.clientX-offset.left);
//e.clientY-offset.top

  //$(".bullet").animate({left: player.x, top: player.y}, 0);

//alert(parseFloat($(".bullet").attr("data-left")));

//$(".bullet").css("left", parseFloat($(this).attr("data-left")) - 5 );

//for(var i = 0; i < 

//  $(".bullet").animate()

$(".bullet").each(function()
{

  var angle = $(this).data("angle");

  var direction = angle / 180 * Math.PI;

  $(this).css("left", "-=" + (Math.cos(direction) * speed) );
  $(this).css("top", "-=" + (Math.sin(direction) * speed) );
  
  var x = (parseFloat($(this).css("left")));
  var y = (parseFloat($(this).css("top")));
  
  var top_hit = (y + 10) <= 0;
  var bottom_hit = (y) >= 700;
  var left_hit = (x + 10) <= 0;
  var right_hit = (x) >= 1000;
  
  bottom_hit = false;
  
  if(top_hit || bottom_hit || left_hit || right_hit)
    $(this).remove();
  

});

request_frame(function()
{
  animate();
});

}


</script>


</body>