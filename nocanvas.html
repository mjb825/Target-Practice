<!DOCTYPE html>
<html>
<head>
<title>Target Practice</title>
<meta charset="utf-8">
<link rel="stylesheet" type="text/css" href="css/style.css">
<script type="application/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script type="application/javascript">

// has game started yet
var started = false;

var turret={};
turret.x=500;
turret.y=0;
turret.length=80;
turret.angle=90;

var shot={};
shot.width=10;
shot.height=10;
shot.speed=1;

// calculate starting position of shot based off of turret's current position
function calculate_shot()
{

  var angle = turret.angle / 180 * Math.PI;
  
  shot.x = 1000 - (turret.length * Math.cos(angle) + turret.x) - (shot.width / 2);
  shot.y = 700 - (turret.length * Math.sin(angle) + turret.y) - (shot.height / 2);

}

$(document).ready(function(){

  $(document).keydown(function(e)
  {
  
    // [left arrow] to decrease angle of turret
    if(e.keyCode==37)
      turret.angle -= 5;
    // [right arrow] to increase angle of turret
    else if(e.keyCode==39)
      turret.angle += 5;
    // [space] to shoot
    else if(e.keyCode==32)
    {
    
      // calculate starting position of shot
      calculate_shot();
      
      // create and append shot
      $("<div>")
        .addClass("bullet")
        .css("left", shot.x+"px")
        .css("top", shot.y+"px")
        .data("angle", turret.angle)
        .appendTo($("#game"));
      
      if(!started)
      {
        started=true;
        animate();
      }
    
    }
  
    // limit degree of turret
    /*
    if(turret.angle <= 20)
      turret.angle = 20;
    else if(turret.angle >= 160)
      turret.angle = 160;
    */
  
    $("#turret").css("transform", "rotate(" + turret.angle + "deg)");
    
  });

});
</script>
</head>

<body>

<div id="game">
  <div id="turret"><div id="barrel"></div></div>
</div>

<script type="application/javascript">
var request_frame = (function(callback)
{
  return window.requestAnimationFrame || window.webkitRequestAnimationFrame || window.mozRequestAnimationFrame || window.oRequestAnimationFrame || window.msRequestAnimationFrame || function(callback) {window.setTimeout(callback, 1000 / 60);};
})();

function animate()
{

  $(".bullet").each(function()
  {

    var angle = $(this).data("angle");

    var direction = angle / 180 * Math.PI;

    $(this).css("left", "-=" + (Math.cos(direction) * shot.speed) );
    $(this).css("top", "-=" + (Math.sin(direction) * shot.speed) );
    
    var x = (parseFloat($(this).css("left")));
    var y = (parseFloat($(this).css("top")));
    
    var top_hit = (y + 10) <= 0;
    var bottom_hit = (y) >= 700;
    var left_hit = (x + 10) <= 0;
    var right_hit = (x) >= 1000;
    
    if(top_hit || bottom_hit || left_hit || right_hit)
      $(this).remove();
    

  });

  request_frame(function()
  {
    animate();
  });

}
</script>

</body>
</html>